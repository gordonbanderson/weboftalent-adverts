# Introduction
The purpose of this module is to allow a website owner to add both their own adverts (images) or use third party adbroker services such as Google Adwords.

Adverts have a layout (e.g. leaderboard, MPU, skyscraper) and belong to a category.  These categories are then assigned to branches of the website content tree.  If a category is not defined ads are not displayed.

# Models
Adverts are administered using a tab called Adverts for model administration.  An advert consists of the following:

* A name
* An image and a website link (if the advert image is provided by the website owners) OR
* Adbroker JavaScript if using third party service
* The layout being used (all images are resized to this size)
* The category of the advert
* A start date and an end date - null value means no limit in either the past of future times.

# Setting a Category
Every page in the SiteTree has an 'Advert Category' tab, where one can choose the advert category from a drop down field.  This category will be use by any descendent pages, unless those pages in turn have a category set.  If no category is set then no advert is shown.

# Impressions and ClickThroughs
Images for adverts are served via PHP so that each time they are served, a numeric counter is incremented by 1.  There is currently no requirement to limit ads per number of impressions - if this becomes the case then checking cookies or referrer might be required.

# Rendering an Advert
To render an advert add the likes of this to your template:

    $RenderAdvert('belowFold','MPUBelowFold', 'PostListInlineAdvert', 1, false)

The parameters are as follows:
* A name that must be unique for the page (otherwise SilverStripe caches method calls with identical signatures)
* The category to render
* The name of the template to use
* The number of adverts to search for (skyscrapers often require 2 for example)
* Whether or not to show the adverts if a request is ajax.  This allows for adverts only to be shown on initial page load using infinite scroll.

Only the first 2 paramaters are mandatory, an advert will by default be rendered by the template InlineAdvert.ss.  The extra parameters allow for more flexibility.

# Site Configuration
Positions of where to show MPU adverts are in the Advert section of the Settings tab.  They are generated by this file, AdvertSiteConfig.php

```
<?php
 
class AdvertSiteConfig extends DataExtension {     

		
	 public static $db = array(			
		'MpuAboveFoldPosition' => 'Int',
		'MpuBelowFoldPosition' => 'Int'				
	  );


	public static $defaults = array(
		'MpuAboveFoldPosition' => '4',
		'MpuBelowFoldPosition' => '11'	
	);
 
    public function updateCMSFields(FieldList $fields) {
	   $fields->addFieldToTab("Root.Advert", new NumericField("MpuAboveFoldPosition", 
	   									"Position the list for the MPU advert above the fold"));
	   $fields->addFieldToTab("Root.Advert", new NumericField("MpuBelowFoldPosition", 
	   									"Position the list for the MPU advert below the fold"));
	  
    }
}
```

In several of the templates, a line like this checks if the current position in the loop is the same as one of those configured values, and only then renders the ad.

    <% if $Pos == $Top.SiteConfig.MpuBelowFoldPosition %>$Top.RenderAdvert('belowFold','MPUBelowFold', 'PostListInlineAdvert', 1, false)<% end_if %>

It should be straightforward enough to add more MPU adverts by looking at the above example.




